!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types"),require("react-router-dom")):"function"==typeof define&&define.amd?define(["exports","react","prop-types","react-router-dom"],t):t(e.CacheRoute={},e.React,e.PropTypes,e.reactRouterDom)}(this,function(e,w,t,u){"use strict";var g="default"in w?w.default:w;t=t&&t.hasOwnProperty("default")?t.default:t;var o=function(e){return void 0===e},l=function(e){return null===e},i=function(e){return"function"==typeof e},h=function(e){return"string"==typeof e},n=function(e){return!(o(e)||l(e))},r=function(e){return e instanceof Array},O=function(e){return"number"==typeof e&&!((t=e)!=t);var t},f=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2];try{O(t)&&(t=String(t));var r=(h(t)?t.split("."):t).reduce(function(e,t){return e[t]},e);return o(r)?n:r}catch(e){return n}},j=function(e){for(var t=arguments.length,n=Array(2<t?t-2:0),r=2;r<t;r++)n[r-2]=arguments[r];var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];o=h(o)?o.split("."):o;var c=f(e,o),a=f(e,o.slice(0,-1));return i(c)?c.call.apply(c,[a].concat(n)):c},m=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return o(e)?j(t):j(e)},void 0)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},p=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),d=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},y=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},C=function(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},v=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},E=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,c=void 0;try{for(var a,i=e[Symbol.iterator]();!(r=(a=i.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,c=e}finally{try{!r&&i.return&&i.return()}finally{if(o)throw c}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},b="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:Function("return this")(),_="object"===("undefined"==typeof global?"undefined":c(global))&&global&&global.Math===Math&&global.Array===Array?global:b,S=f(_,"document.body"),R=f(_,"document.scrollingElement",f(_,"document.documentElement",{}));function T(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return!!n(e)&&(e.scrollWidth>e.clientWidth||e.scrollHeight>e.clientHeight)}function N(e){return i(f(_,"document.getElementById"))?[].concat(a(m(j(e,"querySelectorAll","*"),[])),[e]).filter(T):[]}function A(e){var t=[].concat(a(new Set([].concat(a(function n(e){return e.reduce(function(e,t){return[].concat(a(e),a(r(t)?n(t):[t]))},[])}((r(e)?e:[e]).map(N))),a([R,S].filter(T)))))).map(function(e){return[e,{x:e.scrollLeft,y:e.scrollTop}]});return function(){t.forEach(function(e){var t=E(e,2),n=t[0],r=t[1],o=r.x,c=r.y;n.scrollLeft=o,n.scrollTop=c})}}var K={},M=function(){return Object.entries(K).filter(function(e){var t=E(e,2)[1];return t instanceof H?t.state.cached:Object.values(t).some(function(e){return e.state.cached})})},k=function(){return P({},K)},D=function(e,t){K[e]=t},F=function(e){delete K[e]},L=function(e){return j(e,"reset")},q=function(e){var t=f(K,[e]);t&&(t instanceof H?L(t):Object.values(t).forEach(L))},x=n(g.forwardRef),U="__isComputedUnmatch",B=function(e){return n(e)&&!0!==f(e,U)},W=function(e,t){var n=e.match,r=e.when,o=void 0===r?"forward":r;if(B(n)||(n=null),!t.cached&&n)return{cached:!0,matched:!0};if(t.matched&&!n){var c=f(e,"history.action"),a=!1;if(i(o))a=!o(e);else switch(o){case"always":break;case"back":["PUSH","REPLACE"].includes(c)&&(a=!0);break;case"forward":default:"POP"===c&&(a=!0)}if(a)return{cached:!1,matched:!1}}return{matched:!!n}},H=function(e){function l(e){var t;s(this,l);for(var n=arguments.length,r=Array(1<n?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var c=v(this,(t=l.__proto__||Object.getPrototypeOf(l)).call.apply(t,[this,e].concat(r)));if(c.cacheLifecycles={__listener:{},didCache:function(e){c.cacheLifecycles.__listener.didCache=e},didRecover:function(e){c.cacheLifecycles.__listener.didRecover=e}},c.componentWillReceiveProps=x?void 0:function(e){var t=W(e,c.state);c.setState(t)},c.injectDOM=function(){try{j(c.__parentNode,"insertBefore",c.wrapper,c.__placeholderNode),j(c.__parentNode,"removeChild",c.__placeholderNode)}catch(e){}},c.ejectDOM=function(){try{var e=f(c.wrapper,"parentNode");c.__parentNode=e,j(c.__parentNode,"insertBefore",c.__placeholderNode,c.wrapper),j(c.__parentNode,"removeChild",c.wrapper)}catch(e){}},c.reset=function(){delete c.__revertScrollPos,c.setState({cached:!1})},c.__cacheCreateTime=Date.now(),c.__cacheUpdateTime=c.__cacheCreateTime,e.cacheKey)if(f(e.cacheKey,"multiple")){var a=e.cacheKey,i=a.cacheKey,u=a.pathname;D(i,P({},k()[i],d({},u,c)))}else D(e.cacheKey,c);return"undefined"!=typeof document&&(c.__placeholderNode=document.createComment(" Route cached "+(e.cacheKey?'with cacheKey: "'+f(e.cacheKey,"cacheKey",e.cacheKey)+'" ':""))),c.state=W(e,{cached:!1,matched:!1}),c}return y(l,e),p(l,[{key:"componentDidUpdate",value:function(e,t){if(t.cached&&this.state.cached)return!0===t.matched&&!1===this.state.matched?(this.props.unmount&&this.ejectDOM(),this.__cacheUpdateTime=Date.now(),j(this,"cacheLifecycles.__listener.didCache")):!1===t.matched&&!0===this.state.matched?(this.props.saveScrollPosition&&j(this.__revertScrollPos),this.__cacheUpdateTime=Date.now(),j(this,"cacheLifecycles.__listener.didRecover")):void 0}},{key:"shouldComponentUpdate",value:function(e,t){var n=!1===this.state.matched&&!0===t.matched,r=!0===this.state.cached&&!1===t.cached,o=this.state.matched||t.matched||this.state.cached!==t.cached;return o&&((this.props.unmount&&r||n)&&this.injectDOM(),r||n||!this.props.saveScrollPosition||(this.__revertScrollPos=A(this.props.unmount?this.wrapper:void 0))),o}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.cacheKey,n=e.unmount;if(f(t,"multiple")){var r=t.cacheKey,o=t.pathname,c=P({},k()[r]);delete c[o],0===Object.keys(c).length?F(r):D(r,c)}else F(t);n&&this.injectDOM()}},{key:"render",value:function(){var t=this,e=this.state,n=e.matched,r=e.cached,o=this.props,c=o.className,a=void 0===c?"":c,i=o.behavior,u=o.children,l=m(j(i,void 0,!n),{}),h=l.className,f=void 0===h?"":h,s=C(l,["className"]),p=j(a+" "+f,"trim"),d=""!==p;return r?g.createElement("div",P({className:d?p:void 0},s,{ref:function(e){t.wrapper=e}}),j(u,void 0,this.cacheLifecycles)):null}}]),l}(w.Component);H.propsTypes={history:t.object.isRequired,match:t.object.isRequired,children:t.func.isRequired,className:t.string,when:t.oneOfType([t.func,t.oneOf(["forward","back","always"])]),behavior:t.func,unmount:t.bool,saveScrollPosition:t.bool},H.defaultProps={when:"forward",unmount:!1,saveScrollPosition:!1,behavior:function(e){return e?{style:{display:"none"}}:void 0}},H.getDerivedStateFromProps=x?W:void 0;var V=function(e){function a(){var e,t,n;s(this,a);for(var r=arguments.length,o=Array(r),c=0;c<r;c++)o[c]=arguments[c];return(t=n=v(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o)))).render=function(){return j(n.props,"children")},n.shouldComponentUpdate=function(e){return e.when},v(n,t)}return y(a,e),a}(w.Component);V.propsTypes={when:t.bool.isRequired};var I=n(w.Fragment),X=function(e){function a(){var e,t,n;s(this,a);for(var r=arguments.length,o=Array(r),c=0;c<r;c++)o[c]=arguments[c];return(t=n=v(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o)))).cache={},v(n,t)}return y(a,e),p(a,[{key:"render",value:function(){var e,o=this,t=this.props,h=t.children,f=t.render,s=t.component,p=t.className,d=t.when,m=t.behavior,y=t.cacheKey,v=t.unmount,b=t.saveScrollPosition,n=t.computedMatchForCacheRoute,_=t.multiple,r=C(t,["children","render","component","className","when","behavior","cacheKey","unmount","saveScrollPosition","computedMatchForCacheRoute","multiple"]);return(g.isValidElement(h)||(e=h,0!==g.Children.count(e)))&&(f=function(){return h}),n&&(r.computedMatch=n),_&&!I&&(_=!1),O(_)&&(_=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE;return e<t?t:n<e?n:e}(_,1)),g.createElement(u.Route,r,function(c){var a=c.match,i=c.computedMatch,e=c.location,t=B(c.match),u=e.pathname,r=O(_)?_:1/0,l={when:d,className:p,behavior:m,cacheKey:y,unmount:v,saveScrollPosition:b},n=function(t){return g.createElement(H,t,function(e){return g.createElement(V,{when:B(t.match)},function(){return Object.assign(t,{cacheLifecycles:e}),s?g.createElement(s,t):j(f||h,void 0,t)})})};return _&&t&&(o.cache[u]={updateTime:Date.now(),render:n},Object.entries(o.cache).sort(function(e,t){var n=E(e,2)[1];return E(t,2)[1].updateTime-n.updateTime}).forEach(function(e,t){var n=E(e,1)[0];r<=t&&delete o.cache[n]})),_?g.createElement(w.Fragment,null,Object.entries(o.cache).map(function(e){var t=E(e,2),n=t[0],r=t[1].render,o=n===u?a||i:null;return g.createElement(w.Fragment,{key:n},r(P({},c,l,{cacheKey:y?{cacheKey:y,pathname:n,multiple:!0}:void 0,key:n,match:o})))})):n(P({},c,l))})}}]),a}(w.Component);X.componentName="CacheRoute",X.propTypes={component:t.elementType||t.any,render:t.func,children:t.oneOfType([t.func,t.node]),computedMatchForCacheRoute:t.object,multiple:t.oneOfType([t.bool,t.number])},X.defaultProps={multiple:!1};var z=n(w.Fragment)?function(e){var t=e.children;return g.createElement(w.Fragment,null,t)}:n(w.PropTypes)?function(e){var t=e.children;return g.createElement("div",null,t)}:function(e){return e.children};z.displayName="SwitchFragment";var G=function(e){function a(){var e,t,n;s(this,a);for(var r=arguments.length,o=Array(r),c=0;c<r;c++)o[c]=arguments[c];return(t=n=v(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o)))).getContext=function(){var e=n.props;return{location:e.location,match:e.match}},v(n,t)}return y(a,e),p(a,[{key:"render",value:function(){var e=this.props,t=e.children,o=e.which,n=this.getContext(),c=n.location,a=n.match,i=!1;return g.createElement(V,{when:B(a)},function(){return g.createElement(z,null,g.Children.map(t,function(e){if(!g.isValidElement(e))return null;var t=e.props.path||e.props.from,n=i?null:t?u.matchPath(c.pathname,P({},e.props,{path:t}),a):a,r=void 0;return r=o(e)?g.cloneElement(e,P({location:c,computedMatch:n},l(n)?{computedMatchForCacheRoute:d({},U,!0)}:null)):n&&!i?g.cloneElement(e,{location:c,computedMatch:n}):null,i||(i=!!n),r}))})}}]),a}(u.Switch);G.propTypes={children:t.node,location:t.object.isRequired,match:t.object.isRequired,which:t.func},(G=u.withRouter(G)).defaultProps={which:function(e){return f(e,"type")===X}};var J=G;e.default=X,e.CacheRoute=X,e.CacheSwitch=J,e.dropByCacheKey=q,e.getCachingKeys=function(){return M().map(function(e){return E(e,1)[0]})},e.clearCache=function(){M().forEach(function(e){var t=E(e,1)[0];return q(t)})},e.getCachingComponents=function(){return M().reduce(function(e,t){var n=E(t,2),c=n[0],r=n[1];return P({},e,r instanceof H?d({},c,r):Object.entries(r).reduce(function(e,t){var n=E(t,2),r=n[0],o=n[1];return P({},e,d({},c+"."+r,o))},{}))},{})},Object.defineProperty(e,"__esModule",{value:!0})});
