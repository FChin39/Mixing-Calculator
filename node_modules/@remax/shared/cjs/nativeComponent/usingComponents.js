"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var fs_1 = require("fs");
var resolve_1 = __importDefault(require("resolve"));
var helpers_1 = require("./helpers");
var runWalk = function (filePath, components, options) {
    var walk = function (filePath) {
        var _a = require(filePath).usingComponents, usingComponents = _a === void 0 ? {} : _a;
        Object.values(usingComponents).forEach(function (value) {
            var componentJsPath = '';
            var componentJsonPath = '';
            if (!componentJsPath) {
                var componentPath = helpers_1.getPath(filePath, value);
                componentJsPath = componentPath + ".js";
                componentJsonPath = componentPath + ".json";
            }
            try {
                componentJsPath = resolve_1.default.sync(value, { basedir: options.cwd });
                componentJsonPath = componentJsPath.replace(/\.js/, '.json');
            }
            catch (_a) {
                // ignore
            }
            if (!fs_1.existsSync(componentJsPath) || !fs_1.existsSync(componentJsonPath)) {
                console.error(componentJsPath + " \u6216 " + componentJsonPath + " \u4E0D\u5B58\u5728");
                return;
            }
            components.add(componentJsPath);
        });
    };
    walk(filePath);
};
function usingComponents(id, options) {
    var components = new Set();
    var filePath = id.replace(/\.js$/, '.json');
    if (!fs_1.existsSync(filePath)) {
        console.error("\u6587\u4EF6 " + filePath + " \u4E0D\u5B58\u5728");
        return Array.from(components);
    }
    runWalk(filePath, components, options);
    return Array.from(components);
}
exports.default = usingComponents;
